name: ğŸ¤– Codex Auto Fix

on:
  push:
    branches:
      - main
      - codex/*
  pull_request:
    branches:
      - main

jobs:
  auto-fix:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§© Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ§° Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: âš™ï¸ Install dependencies
        run: npm install prettier

      - name: ğŸ§  Auto-fix source code
        run: |
          echo "Running Codex Auto-Fix..."
          find . -type f -name '*.tsx' -o -name '*.ts' -o -name '*.js' -o -name '*.jsx' | while read file; do
            sed -i '/<<<<<<<\|=======\|>>>>>>>/d' "$file"
            if ! grep -q '"use client"' "$file"; then
              sed -i '1i"use client"\n' "$file"
            fi
          done
          npx prettier --write .

      - name: ğŸš€ Commit & Push changes
        run: |
          git config user.name "Codex AutoFix Bot"
          git config user.email "codex@dsdgroup.es"
          git add .
          git commit -m "ğŸ¤– auto-fix: format and clean code" || echo "No changes to commit"
          git push
